<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>SoundManager 2: A Javascript Sound API - MPC Demo</title>
<meta name="description" content="An example drum machine (MPC) demo using the SoundManager 2 JavaScript Audio API" />
<meta name="keywords" content="javascript mpc, javascript drum machine, javascript sound, javascript audio, DHTML sound, work by Scott Schiller, schillmania, javascript to flash communication" />
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252" />

<script type="text/javascript" src="script/mysoundmanager.js"></script>
<!-- midi.js package -->
 <script src="script/inc/midijs/AudioDetect.js" type="text/javascript"></script>
 <script src="script/inc/midijs/LoadPlugin.js" type="text/javascript"></script>
 <script src="script/inc/midijs/Plugin.js" type="text/javascript"></script>
 <script src="script/inc/midijs/Player.js" type="text/javascript"></script>
 <!-- jasmid package -->
 <script src="script/inc/jasmid/stream.js"></script>
 <script src="script/inc/jasmid/midifile.js"></script>
 <script src="script/inc/jasmid/replayer.js"></script>
 <script src="script/jquery-1.9.1.min.js"></script>

</head>
<body>
	<div>	
		<object type="application/x-shockwave-flash" data="swf/mysoundmanager_debug.swf" id="mysoundmanager" style="margin:0 10px;width:auto;height:auto;">

			<param name="movie" value="swf/mysoundmanager_debug.swf" />
			<param name="wmode" value="transparent" /> <!-- Or opaque, etc. -->

			<!-- ? Required paramter or not, depends on application -->
			<param name="FlashVars" value="" />

			<param name="quality" value="high" />
			<param name="haspriority" value="true" />

			<param name="menu" value="false" />

		</object>
	</div>
	<script type="text/javascript">
		mysoundManager = new MySoundManager();

		window.MySoundManager = MySoundManager; // constructor
		window.mysoundManager = mysoundManager; // public API, flash callbacks etc.
		
		// load some instruments
		mysoundManager._onFlashLoadCallback = function() {
				mysoundManager.setDebug(false);
				mysoundManager.load("harp", "12", "audio/harp-c2.mp3");
				mysoundManager.load("harp", "24", "audio/harp-c3.mp3");
				mysoundManager.load("harp", "36", "audio/harp-c4.mp3");
				mysoundManager.load("harp", "48", "audio/harp-c5.mp3");
				mysoundManager.load("harp", "60", "audio/harp-c6.mp3");
				mysoundManager.load("harp", "72", "audio/harp-c7.mp3");
				mysoundManager.load("female", "48", "audio/chorus-female-c5.mp3");
				mysoundManager.load("female", "60", "audio/chorus-female-c6.mp3");
				mysoundManager.load("male", "24", "audio/chorus-male-c3.mp3");
				mysoundManager.load("male", "36", "audio/chorus-male-c4.mp3");

				
				/*
				playInterval();
				playInterval();
				*/
		};

		var init_pentatone = 12;
		var tempo_harp = 1000;
		var octave_range = 2;
		function playInterval() {
			mysoundManager.play("harp", Math.ceil((Math.random()*20+10)));
			self.setInterval( function () {
				// pentatonic array
				var pentatones= [0,2,4,7,9];
				var the_chosen = pentatones[Math.floor(Math.random() * pentatones.length)]
				var octave = Math.floor(Math.random()*octave_range)*12;
				mysoundManager.play("harp", ""+(the_chosen + octave + init_pentatone)); 
			}, tempo_harp );
		}
		
		function wuff(bla) {
			console.log("just a test");
		}
		MIDI.Player.addListener(function(data) { // set it to your own function!
			var now = data.now; // where we are now
			var end = data.end; // time when song ends
			var channel = data.channel; // channel note is playing on
			var message = data.message; // 128 is noteOff, 144 is noteOn
			var note = data.note; // the note
			var velocity = data.velocity; // the velocity of the note
			// then do whatever you want with the information!
			if (console != undefined) {
				// console.log("MIDI Player played note", note, message, now);
			}
		});
		
		// load midi file into player
		MIDI.Player.loadFile('audio/forellenquintett.mid');
		// MIDI.Player.loadFile('audio/test.mid');
		// MIDI.Player.loadFile('audio/gougeaway.mid');
		
		function stopAllIntervals () {
			// Set a fake timeout to get the highest timeout id
			var highestTimeoutId = setTimeout(";");
			for (var i = 0 ; i < highestTimeoutId ; i++) {
				clearTimeout(i); 
			}
			
			// also stop following tone
			mysoundManager.stopNamedNote("test")
		}
		
		
		// used for mouse example
		var tempX = 0;
		var tempY = 0;
		
		// this function is from http://stackoverflow.com/questions/3011418/onmousemove-get-mouse-position

		$().ready(function () {
		console.log("document ready");
		$(window).mousemove(function(e){
		  var pageCoords = "( " + e.pageX + ", " + e.pageY + " )";
		  var clientCoords = "( " + e.clientX + ", " + e.clientY + " )";
		  mysoundManager.setNamedNoteSetting("test", "midiNr",""+((e.clientX/600) + 20));

		});
		}
		)
		function followMouse() {
			mysoundManager.playNamedNote("test", "harp","22")
		}
		function playMidi() {
			MIDI.Player.start();
		}
		
	</script>
		<button onclick="javascript:void(stopAllIntervals())">Stop Everything</button>
		<button onclick="javascript:void(playInterval())">Play the random harp</button>
		<button onclick="javascript:void(followMouse())">Follow Mouse with Tone</button>
		<button onclick="javascript:void(playMidi())">Play Midi file</button>
</body>
</html>